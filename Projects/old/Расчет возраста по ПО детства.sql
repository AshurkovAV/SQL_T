UPDATE SLUCH SET VOZR =
                             (CASE
								WHEN dbo.GetDateDiff(dr, DATE_2) = 0 THEN 'G00.M00'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 1 THEN 'G00.M01'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 2 THEN 'G00.M02'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 3 THEN 'G00.M03'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 4 THEN 'G00.M04'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 5 THEN 'G00.M05'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 6 THEN 'G00.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 7 THEN 'G00.M07'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 8 THEN 'G00.M08'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 9 THEN 'G00.M09'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 10 THEN 'G00.M10'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 11 THEN 'G00.M11'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 12 THEN 'G00.M12'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 13 THEN 'G00.M12'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 14 THEN 'G00.M12'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 15 THEN 'G01.M03'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 16 THEN 'G01.M03'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 17 THEN 'G01.M03'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 18 THEN 'G01.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 19 THEN 'G01.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 19 THEN 'G01.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 20 THEN 'G01.M09'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 21 THEN 'G01.M09'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 22 THEN 'G01.M09'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 23 THEN 'G01.M09'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 24 THEN 'G02.M00'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 25 THEN 'G02.M00'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 26 THEN 'G02.M00'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 27 THEN 'G02.M00'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 28 THEN 'G02.M00'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 29 THEN 'G02.M00'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 30 THEN 'G02.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 31 THEN 'G02.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 32 THEN 'G02.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 33 THEN 'G02.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 34 THEN 'G02.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 35 THEN 'G02.M06'
								WHEN dbo.GetDateDiff(dr, DATE_2) = 36 THEN 'G03.M00'
								WHEN (year(DATE_2) - year(dr)) = 3 THEN 'G03.M00'
								WHEN (year(DATE_2) - year(dr)) = 4 THEN 'G04.M00'
								WHEN (year(DATE_2) - year(dr)) = 5 THEN 'G05.M00'
								WHEN (year(DATE_2) - year(dr)) = 6 THEN 'G06.M00'
								WHEN (year(DATE_2) - year(dr)) = 7 THEN 'G07.M00'
								WHEN (year(DATE_2) - year(dr)) = 8 THEN 'G08.M00'
								WHEN (year(DATE_2) - year(dr)) = 9 THEN 'G09.M00'
								WHEN (year(DATE_2) - year(dr)) = 10 THEN 'G10.M00'
								WHEN (year(DATE_2) - year(dr)) = 11 THEN 'G11.M00'
								WHEN (year(DATE_2) - year(dr)) = 12 THEN 'G12.M00'
								WHEN (year(DATE_2) - year(dr)) = 13 THEN 'G13.M00'
								WHEN (year(DATE_2) - year(dr)) = 14 THEN 'G14.M00'
								WHEN (year(DATE_2) - year(dr)) = 15 THEN 'G15.M00'
								WHEN (year(DATE_2) - year(dr)) = 16 THEN 'G16.M00'
								WHEN (year(DATE_2) - year(dr)) = 17 THEN 'G17.M00'
								END)														
					from SLUCH sl 
                    JOIN PACIENT pa on sl.PID = pa.ID
                    join CalcAmbTarif t on sl.USL_OK = t.USL_OK and sl.idsp = t.IDSP and sl.Profil = t.Profil and sl.OS_SLUCH_REGION = t.OS_SLUCH
					and (sl.DATE_2 >= t.TBEG and sl.DATE_2 < t.TEND +1) 
                    where (sl.VOPL = 1 or sl.VOPL is NULL) and OS_SLUCH_REGION = 11 and sl.USL_OK = 3 and VOZR is NULL                    